ACCION PARCIAL2013 ES
AMBIENTE

CLAVE = REGISTRO
	CODPCIA: N(4)
	NROCENTRAL: N(4)
FINREGISTRO

ANUAL = REGISTRO
	CLAVE: CLAVE
	CANTVOZ: N
	CANTDAT: N
	CANTSMS: N
FINREGISTRO

COMUNICACIONES = REGISTRO
	CLAVE: CLAVE;
	CODMOV: ('ALTA','MODIFICADO');
	TDC: ('1','2','3')
	DT: N
FINREGISTRO

AMAE: ARCHIVO DE ANUAL ORDENADO POR CLAVE;
AMAESAL: ARCHIVO DE ANUAL ORDENADO POR CLAVE;
AMOV: ARCHIVO DE COMUNICACIONES ORDENADO POR CLAVE;
RMAE: ANUAL;
RMOV: COMUNICACIONES;
RSAL: ANUAL;
TOTVAZ, TOTDAT, TOTDT: N(4);
PROCESO
	ABRIR/S (AMAESAL);
	ABRIR/A (AMAE);
	ABRIR/A (AMAE);
	LEERMAE;
	LEERMOV;
	MIENTRAS (AMAE.CLAVE <> HV) O (AMOV <> HV) HACER
		SI (AMAE.CLAVE < AMOV.CLAVE ) ENTONCES
			RSAL:= RMAE; 
          	ESC(AMAESAL, RSAL);
          	LEERMAE;
		SINO
			SI (AMAE.CLAVE = AMOV.CLAVE ) ENTONCES
				IGUAL;
				MIENTRAS (AMAE.CLAVE = AMOV.CLAVE ) HACER
					SEGUN (TDC) HACER
						1: RSAL.CANTVOZ:= RMAE.CANTVOZ + AMOV.DT;
						2: RSAL.CANTDAT:= RMAE.CANTVOZ + AMOV.DT;
						3: RSAL.CANTSMS:= RMAE.CANTVOZ + AMOV.DT;
					FINSEGUN	
				FINMIENTRAS
			SINO
				DISTINTO;
			FINSI
		FINSI	
	FINMIENTRAS
CERRARARCH;
FINACCION

SUBACCION LEERMAE ES
	LEER (AMAE, ANUAL);
	SI FDA (AMAE) ENTONCES
		CLAVE.CODPCIA:= HV
		CLAVE.NROCENTRAL:= HV
	FINSI
FINSUBACCION

SUBACCION LEERMOV ES
	LEER (AMOV, COMUNICACIONES);
	SI FDA (AMOV) ENTONCES
		AMOV.CODPCIA:= HV
		AMOV.NROCENTRAL:= HV
	FINSI
FINSUBACCION

SUBACCION IGUAL ES
	SI (RMOV.CODMOV = 'ALTA') ENTONCES
   		RSAL:= RMAE;
    	ESC(AMAESAL, RSAL);
  	SINO
   		SI (RMOV.CODMOV = 'MODIFICACION') ENTONCES 
      		MODMAE;
      		RSAL := RMAE;
      		ESC(AMAESAL, RSAL);
    	SINO 
      		RSAL:= RMAE;
      		ESC(AMAESAL, RSAL);
    	FINSI
  	FINSI
  LEERMAE;
  LEERMOV;
FINSUBACCION

SUBACCION MODMAE ES
	SI (RMOV.CODPCIA <> '') ENTONCES  
    	RMAE.CODPCIA:= RMOV.CODPCIA
  	FINSI
 		SI (RMOV.NROCENTRAL <> '') ENTONCES
    		RMAE.NROCENTRAL := RMOV.NROCENTRAL
  		FINSI
FINSUBACCION